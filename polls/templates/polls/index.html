<!DOCTYPE html>
<html>

<head>
    <title>Polling App</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <h1>All Polls</h1>
    <ul id="tag-list"></ul>
    <button id="filter-btn">Filter</button>
    <table>
        <thead>
            <tr>
                <th>Number</th>
                <th>Question Text</th>
                <th>Total Votes</th>
                <th>Tags</th>
            </tr>
        </thead>
        <tbody id="question-table-body"></tbody>
    </table>
    <div id="question-table-container"></div>
    <script>
        $(document).ready(function () {

            function updateQuestionList(tag_names) {
                var tags = tag_names.join(',')
                $.ajax({
                    url: 'filterbytag/',
                    type: 'GET',
                    data: { tags: tags },
                    dataType: 'json',
                    success: function (response) {
                        var questions = response.data;
                        console.log(questions)
                        $('#question-table-body').empty();
                        for (var i = 0; i < questions.length; i++) {
                            var question = questions[i];
                            $('#question-table-body').append('<tr><td>' + (i + 1) + '</td><td>' + question.question_text + '</td><td>' + question.total_votes + '</td><td>' + question.tag_name + '</td></tr>');
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error(error);
                    }
                });
            }


            $.ajax({
                url: 'tags/',
                type: 'GET',
                dataType: 'json',
                success: function (response) {
                    var tags = response.tags;
                    console.log(tags)
                    for (var i = 0; i < tags.length; i++) {
                        var tag = tags[i];
                        $('#tag-list').append('<li><input type="checkbox" id="tag-' + tag.tag_name + '" value="' + tag.tag_name + '">' + tag.tag_name + '</li>');
                    }
                },
                error: function (xhr, status, error) {
                    console.error(error);
                }
            });

            $('#filter-btn').click(function () {
                var tag_names = [];
                console.log(tag_names)
                $('input[type="checkbox"]:checked').each(function () {
                    tag_names.push($(this).val());
                });
                console.log(tag_names)
                updateQuestionList(tag_names);
            });


        });
    </script>
</body>

</html>